# –û—Ç—á–µ—Ç: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –∫–Ω–æ–ø–æ–∫ –≤ Telegram –±–æ—Ç–µ

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã

### –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ª–æ–≥–æ–≤ –æ –≤—ã–∑–æ–≤–µ `sendMessage`**
   - –í –ª–æ–≥–∞—Ö –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π `[TelegramDomainBot] Sending message with keyboard:`
   - –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –ª–∏–±–æ –º–µ—Ç–æ–¥ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è, –ª–∏–±–æ –æ—à–∏–±–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –¥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

2. **–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON**
   - –í –ª–æ–≥–∞—Ö –µ—Å—Ç—å –æ—à–∏–±–∫–∞: `SyntaxError: Unexpected token '<', "<html>`
   - Telegram API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç HTML –≤–º–µ—Å—Ç–æ JSON
   - –≠—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–æ–±–ª–µ–º—É —Å –∑–∞–ø—Ä–æ—Å–æ–º (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL, –æ—à–∏–±–∫–∞ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ Telegram, –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å –ø—Ä–æ–∫—Å–∏)

3. **–ö–Ω–æ–ø–∫–∏ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è**
   - –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è, –Ω–æ –±–µ–∑ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
   - –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–∑-–∑–∞ –æ—à–∏–±–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ `reply_markup` –∏–ª–∏ –∏–∑-–∑–∞ —Ç–æ–≥–æ, —á—Ç–æ Telegram API –æ—Ç–∫–ª–æ–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å

### –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞:

1. **–§–æ—Ä–º–∞—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π**
   - –°–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Telegram Bot API, —Ñ–æ—Ä–º–∞—Ç `{ inline_keyboard: [[{ text, callback_data }]] }` –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω
   - `callback_data` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π 1-64 –±–∞–π—Ç–∞ (–Ω–∞—à–∏ –∑–Ω–∞—á–µ–Ω–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç)

2. **–ü—Ä–æ–±–ª–µ–º–∞ –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ –æ—Ç–≤–µ—Ç–∞**
   - –ö–æ–¥ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç HTTP —Å—Ç–∞—Ç—É—Å –∫–æ–¥ –ø–µ—Ä–µ–¥ –ø–∞—Ä—Å–∏–Ω–≥–æ–º JSON
   - –ï—Å–ª–∏ Telegram API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É (HTML —Å—Ç—Ä–∞–Ω–∏—Ü—É), –∫–æ–¥ –ø—ã—Ç–∞–µ—Ç—Å—è –ø–∞—Ä—Å–∏—Ç—å –µ—ë –∫–∞–∫ JSON
   - –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ `SyntaxError` –∏ —Å–∫—Ä—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—É—é –ø—Ä–æ–±–ª–µ–º—É

## üõ†Ô∏è –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–§–∞–π–ª:** `telegram-domain-bot.js`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `showMainMenu()` - —Ç–µ–ø–µ—Ä—å –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –∫–∞–∂–¥—ã–π —à–∞–≥
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `handleCommand()` - –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –≤—ã–∑–æ–≤ –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã
- –ò–∑–º–µ–Ω–µ–Ω —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å `debug` –Ω–∞ `info` –¥–ª—è payload
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã

**–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ:**
- –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —Ç–æ—á–Ω–æ —É–≤–∏–¥–µ—Ç—å, –Ω–∞ –∫–∞–∫–æ–º —ç—Ç–∞–ø–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ—à–∏–±–∫–∞
- –ú–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å —Ñ–æ—Ä–º–∞—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
- –ú–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å –ø–æ–ª–Ω—ã–π payload –∑–∞–ø—Ä–æ—Å–∞

### 2. –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞ –æ—Ç Telegram API

**–§–∞–π–ª:** `telegram-domain-bot.js`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ HTTP —Å—Ç–∞—Ç—É—Å –∫–æ–¥–∞ –ø–µ—Ä–µ–¥ –ø–∞—Ä—Å–∏–Ω–≥–æ–º JSON
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –æ—Ç–≤–µ—Ç –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `{` (—è–≤–ª—è–µ—Ç—Å—è JSON)
- –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ - —Ç–µ–ø–µ—Ä—å –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è —Å—Ç–∞—Ç—É—Å –∫–æ–¥, –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∏ –ø–µ—Ä–≤—ã–µ 500 —Å–∏–º–≤–æ–ª–æ–≤ –æ—Ç–≤–µ—Ç–∞
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª—É—á–∞—è, –∫–æ–≥–¥–∞ Telegram API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç HTML –≤–º–µ—Å—Ç–æ JSON

**–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ:**
- –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å —Ä–µ–∞–ª—å–Ω—É—é –æ—à–∏–±–∫—É –æ—Ç Telegram API
- –ú–æ–∂–Ω–æ –ø–æ–Ω—è—Ç—å, –ø–æ—á–µ–º—É –∑–∞–ø—Ä–æ—Å –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω, –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL, –ø—Ä–æ–±–ª–µ–º–∞ —Å –ø—Ä–æ–∫—Å–∏)
- –ú–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å —Å—Ç–∞—Ç—É—Å –∫–æ–¥ –∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞

### 3. –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ `showMainMenu`

**–§–∞–π–ª:** `telegram-domain-bot.js`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –û–±–µ—Ä–Ω—É—Ç–æ –≤ try-catch –±–ª–æ–∫
- –û—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å –ø–æ–ª–Ω—ã–º stack trace
- –û—à–∏–±–∫–∏ –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è –¥–∞–ª—å—à–µ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ `handleCommand`

**–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ:**
- –¢–µ–ø–µ—Ä—å –æ—à–∏–±–∫–∏ –Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è
- –ú–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å –ø–æ–ª–Ω—ã–π stack trace –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- –û—à–∏–±–∫–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è

## üìä –ü–æ—á–µ–º—É –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ñ–∏–∫—Å—ã –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∏

### –§–∏–∫—Å 1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ `sendMessage`
**–ü—Ä–æ–±–ª–µ–º–∞:** –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –±—ã–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ, –Ω–æ –æ—à–∏–±–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–∞ –¥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏–ª–∏ –ª–æ–≥–∏ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏—Å—å –∏–∑-–∑–∞ —É—Ä–æ–≤–Ω—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (`debug` –≤–º–µ—Å—Ç–æ `info`)

### –§–∏–∫—Å 2: –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞ `reply_markup`
**–ü—Ä–æ–±–ª–µ–º–∞:** –§–æ—Ä–º–∞—Ç –±—ã–ª –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Å —Å–∞–º–æ–≥–æ –Ω–∞—á–∞–ª–∞, –ø—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –Ω–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ, –∞ –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ –æ—Ç–≤–µ—Ç–∞ –æ—Ç Telegram API

### –§–∏–∫—Å 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–∞ –æ—Ç Telegram API
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –±—ã–ª–∞ –Ω–µ–ø–æ–ª–Ω–æ–π - –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–ª—Å—è —Å—Ç–∞—Ç—É—Å –∫–æ–¥ –∏ —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –ø–µ—Ä–µ–¥ –ø–∞—Ä—Å–∏–Ω–≥–æ–º JSON

## ‚úÖ –ü–æ—á–µ–º—É —Ç–µ–∫—É—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Å—Ä–∞–±–æ—Ç–∞—Ç—å

1. **–ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —Ç–æ—á–Ω–æ —É–≤–∏–¥–µ—Ç—å, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ
   - –ú–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å —Ñ–æ—Ä–º–∞—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∏ payload –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
   - –ú–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å –æ—Ç–≤–µ—Ç –æ—Ç Telegram API

2. **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**
   - –¢–µ–ø–µ—Ä—å –æ—à–∏–±–∫–∏ –Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è
   - –ú–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å —Ä–µ–∞–ª—å–Ω—É—é –æ—à–∏–±–∫—É –æ—Ç Telegram API
   - –ú–æ–∂–Ω–æ –ø–æ–Ω—è—Ç—å, –ø–æ—á–µ–º—É –∑–∞–ø—Ä–æ—Å –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–∞ –ø–µ—Ä–µ–¥ –ø–∞—Ä—Å–∏–Ω–≥–æ–º**
   - –¢–µ–ø–µ—Ä—å –∫–æ–¥ –Ω–µ –ø—ã—Ç–∞–µ—Ç—Å—è –ø–∞—Ä—Å–∏—Ç—å HTML –∫–∞–∫ JSON
   - –ú–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç Telegram API
   - –ú–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å —Å—Ç–∞—Ç—É—Å –∫–æ–¥ –∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:**
   ```bash
   cd ~/reverse-proxy
   git pull origin main
   pm2 restart reverse-proxy --update-env
   ```

2. **–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –±–æ—Ç—É:**
   - –û—Ç–ø—Ä–∞–≤–∏—Ç—å `/start` –∏–ª–∏ `/menu` –≤ Telegram

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:**
   ```bash
   pm2 logs reverse-proxy --lines 100
   ```

4. **–ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `showMainMenu` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å payload –∑–∞–ø—Ä–æ—Å–∞
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–≤–µ—Ç –æ—Ç Telegram API (—Å—Ç–∞—Ç—É—Å –∫–æ–¥, —Ñ–æ—Ä–º–∞—Ç)
   - –ï—Å–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∞ - —É–≤–∏–¥–µ—Ç—å —Ä–µ–∞–ª—å–Ω—É—é –ø—Ä–∏—á–∏–Ω—É

## üìù –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –≤ –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:
1. `[TelegramDomainBot] handleCommand: /start for chat ...`
2. `[TelegramDomainBot] Calling showMainMenu for chat ...`
3. `[TelegramDomainBot] showMainMenu called for chat ...`
4. `[TelegramDomainBot] Created keyboard: {...}`
5. `[TelegramDomainBot] Sending message with keyboard: {...}`
6. `[TelegramDomainBot] Sending payload to Telegram API: {...}`
7. `[TelegramDomainBot] Response status: 200, headers: {...}`
8. `[TelegramDomainBot] Message sent successfully. Result: {...}`

–ï—Å–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∞, –≤ –ª–æ–≥–∞—Ö –±—É–¥–µ—Ç –≤–∏–¥–Ω–∞ —Ä–µ–∞–ª—å–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω, –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL, –ø—Ä–æ–±–ª–µ–º–∞ —Å –ø—Ä–æ–∫—Å–∏, –∏ —Ç.–¥.)
