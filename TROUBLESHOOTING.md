# üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã ERR_CONNECTION_CLOSED

## –ü—Ä–æ–±–ª–µ–º–∞
–°–∞–π—Ç `efflow-m50.com` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É `ERR_CONNECTION_CLOSED` - —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ.

---

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∑–∞–ø—É—â–µ–Ω–æ –ª–∏ Node.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å—ã Node.js
ps aux | grep node

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —Å–ª—É—à–∞–µ—Ç –ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –ø–æ—Ä—Ç—É 3000
ss -tlnp | grep :3000
# –ò–õ–ò
netstat -tlnp | grep :3000

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ PM2 —Å—Ç–∞—Ç—É—Å
pm2 status
pm2 logs
```

**–ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—É—â–µ–Ω–æ:**
```bash
cd /opt/reverse-proxy  # –∏–ª–∏ –ø—É—Ç—å –∫ –≤–∞—à–µ–º—É –ø—Ä–æ–µ–∫—Ç—É
pm2 start pm2.config.js
# –ò–õ–ò
pm2 start server.js --name reverse-proxy
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ nginx

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å nginx
systemctl status nginx

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
nginx -t

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ nginx
tail -50 /var/log/nginx/efflow-m50-error.log
tail -50 /var/log/nginx/efflow-m50-access.log
```

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Node.js –Ω–∞–ø—Ä—è–º—É—é

```bash
# –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Node.js –Ω–∞–ø—Ä—è–º—É—é
curl http://127.0.0.1:3000

# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –æ—Ç–≤–µ—Ç –æ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
# –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ - –ø—Ä–æ–±–ª–µ–º–∞ –≤ Node.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
```

### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π—Ä–≤–æ–ª

```bash
# Ubuntu/Debian
ufw status
# –†–∞–∑—Ä–µ—à–∏—Ç–µ –ø–æ—Ä—Ç—ã –µ—Å–ª–∏ –Ω—É–∂–Ω–æ:
# ufw allow 80/tcp
# ufw allow 443/tcp

# CentOS/RHEL
firewall-cmd --list-all
# –†–∞–∑—Ä–µ—à–∏—Ç–µ –ø–æ—Ä—Ç—ã –µ—Å–ª–∏ –Ω—É–∂–Ω–æ:
# firewall-cmd --permanent --add-service=http
# firewall-cmd --permanent --add-service=https
# firewall-cmd --reload
```

### 5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
# PM2 –ª–æ–≥–∏
pm2 logs reverse-proxy --lines 50

# –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–µ—Å–ª–∏ –µ—Å—Ç—å)
tail -50 /opt/reverse-proxy/logs/*.log
```

---

## üîß –†–µ—à–µ–Ω–∏—è

### –†–µ—à–µ–Ω–∏–µ 1: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
pm2 stop reverse-proxy

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–Ω–æ–≤–∞
pm2 start reverse-proxy

# –ò–õ–ò –ø–æ–ª–Ω—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
pm2 restart reverse-proxy

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
pm2 logs reverse-proxy
```

### –†–µ—à–µ–Ω–∏–µ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ nginx

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `/etc/nginx/sites-available/efflow-m50.com` –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω `proxy_pass`:

```nginx
location / {
    proxy_pass http://127.0.0.1:3000;
    # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
}
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å:
```bash
nginx -t
```

–ï—Å–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∏ - –∏—Å–ø—Ä–∞–≤—å—Ç–µ –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ:
```bash
systemctl reload nginx
```

### –†–µ—à–µ–Ω–∏–µ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–π–º–∞—É—Ç–æ–≤

–£–≤–µ–ª–∏—á—å—Ç–µ —Ç–∞–π–º–∞—É—Ç—ã –≤ nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

```nginx
proxy_connect_timeout 120s;
proxy_send_timeout 120s;
proxy_read_timeout 120s;
```

–ò –≤ `.env` —Ñ–∞–π–ª–µ:
```env
PROXY_TIMEOUT=60000
```

### –†–µ—à–µ–Ω–∏–µ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞–º—è—Ç–∏ –∏ —Ä–µ—Å—É—Ä—Å–æ–≤

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
free -h

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU
top

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ
df -h
```

–ï—Å–ª–∏ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç —Ä–µ—Å—É—Ä—Å–æ–≤ - —É–≤–µ–ª–∏—á—å—Ç–µ –∏–ª–∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ.

### –†–µ—à–µ–Ω–∏–µ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—à–∏–±–æ–∫ –≤ –∫–æ–¥–µ

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ —Ä–µ–∂–∏–º–µ –æ—Ç–ª–∞–¥–∫–∏
cd /opt/reverse-proxy
node server.js

# –ò–ª–∏ —á–µ—Ä–µ–∑ PM2 —Å –≤—ã–≤–æ–¥–æ–º –ª–æ–≥–æ–≤
pm2 logs reverse-proxy --lines 100
```

---

## üö® –ß–∞—Å—Ç—ã–µ –ø—Ä–∏—á–∏–Ω—ã ERR_CONNECTION_CLOSED

1. **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–∞–¥–∞–µ—Ç –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–ø—Ä–æ—Å–∞**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É –∏—Å–∫–ª—é—á–µ–Ω–∏–π –≤ –∫–æ–¥–µ

2. **–¢–∞–π–º–∞—É—Ç—ã —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–µ**
   - –£–≤–µ–ª–∏—á—å—Ç–µ —Ç–∞–π–º–∞—É—Ç—ã –≤ nginx –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

3. **–ù–µ—Ö–≤–∞—Ç–∫–∞ –ø–∞–º—è—Ç–∏**
   - –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É–±–∏–≤–∞–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–æ–π (OOM)
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `dmesg | grep -i "out of memory"`

4. **–ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π—Ä–≤–æ–ª
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ç–µ–≤—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

5. **–û—à–∏–±–∫–∏ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å nginx
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

---

## üìã –ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ (–≤—Å–µ –∫–æ–º–∞–Ω–¥—ã —Å—Ä–∞–∑—É)

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ Node.js
ss -tlnp | grep :3000
pm2 status

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ nginx
systemctl status nginx
nginx -t

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
curl http://127.0.0.1:3000
curl http://efflow-m50.com

# 4. –õ–æ–≥–∏
pm2 logs reverse-proxy --lines 20
tail -20 /var/log/nginx/efflow-m50-error.log

# 5. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
pm2 restart reverse-proxy
systemctl reload nginx
```

---

## ‚úÖ –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É —Å–∞–π—Ç–∞:
```bash
curl -I http://efflow-m50.com
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å HTTP/1.1 200 OK

# –ò–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
# http://efflow-m50.com
```

---

## üÜò –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç

1. –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
   ```bash
   pm2 delete reverse-proxy
   cd /opt/reverse-proxy
   npm install
   pm2 start pm2.config.js
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏:
   ```bash
   journalctl -xe
   dmesg | tail -50
   ```

3. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä (–ø–æ—Å–ª–µ–¥–Ω–∏–π –≤–∞—Ä–∏–∞–Ω—Ç):
   ```bash
   reboot
   ```
